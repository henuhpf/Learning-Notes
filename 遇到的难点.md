- 学而不思则罔

# 遇到的难点

#### oracle

- sql执行速度慢， 对其中数据量较大的关联表进行条件筛选，然后explain sql，发现sql走的全表扫描未走索引，添加索引解决。
- 4951150 select count 花费9s

#### Redis

- 同时开启aof 和 rdb ，redis会从aof文件中读取数据，在模拟aof丢失删除情况下，redis会建一个空的aof文件，重启后的redis数据库为空。

#### 分库分表

- 分库分表后，如何关联查询 全局表：字典数据，所有库拷贝；字段冗余：部分字段如姓名可以在业务表中和用户编号一起存放； 系统层组装：分别查询出所有，然后组装起来；

#### Java

- 如果 jvm 中某个线程的栈帧被弹出，栈帧中的局部变量表需要被垃圾回收吗？
  - JVM 中的垃圾回收是针对堆里面的 年轻代、老年代、永久代（方法区），堆中存储的是局部变量所引用的实例。
  - 栈帧中的局部变量存储的是引用或者实际值，随着栈帧被弹出就会直接被清理掉。
- java 静态引用类型变量 存储的是该实例的引用，对象实例仍存储在堆中。
- 并发上来了,会有哪些方面的压力？
  - 并发上来之后，内存、网络带宽、磁盘IO、数据库，都是系统的瓶颈，比如网络带宽打满，你的请求就会排队卡住，磁盘IO变满，数据库性能下降，都会导致请求处理慢几十倍
- 年轻代 eden、 survivor1、 survivor2
  - 有趣的例子：假设我们去游泳，泳池三条泳道，分别为1，2，3。 一开始，都在泳道1游泳，过了一阵后，水脏了，要换水，于是把大家赶到泳道2。 接下来，泳道1换好水后，新来的人，安排到泳道1，此时，泳道1和泳道2都有人。 过了一阵，泳道1，2水都脏了，要换水，于是把人赶到泳道3，然后把1，2泳道的水换掉。 再过一阵，新来的人被分配到泳道1，此时，泳道1，3有人。 再过一段时间，又要换水了，然后把泳道1，3的人赶到泳道2，然后把泳道1，3的水换掉。 再接下来。新来的人就被分到泳道1，此时泳道1，2有人。 过一阵后，泳道1，2换水，把人赶到泳道3。。 周而复始。。。 无穷无尽。。。

#### Nginx

- https 跳转， 代码中写相对路径时,因为nginx所代理的服务之间以 http 协议调用， 如果是相对路径 协议会由 https 转为 http。后端获取的 request.getScheme() 永远为 http
- 如果将相对路径替换成绝对路径。
- 可以通过配置 springmvc 和 nginx 解决。

#### JVM 调优

一个单体的spring boot 在8g内存台式机上跑， 需要加载的类特别多 ，根本没有什么百万流量。查看 GC 日志 ，jvm一启动 直接每秒10m的内存增长速度，光是启动要花十分钟。启动期间就进行了两次full gc，半小时走了十几次ygc 。

解决方案：调整了新老比例为2:1 ，共分配4g， 之后 fgc一直为0， ygc半小时只有两次， 启动降为1分钟以内。

